worker_processes auto;

worker_connections 64;

access_log off;
# to boost I/O on HDD we can disable access logs
# this prevent nginx from logging every action in a log file named `access.log`.

keepalive_timeout 15;
# default is 65;
# server will close connection after this time (in seconds)

gzip_vary on;
gzip_proxied any;
gzip_comp_level 2;
gzip_buffers 16 8k;
gzip_http_version 1.1;
gzip_min_length 256;

proxy_cache_path /data/nginx/ramcache keys_zone=my_zone:10m inactive=1d;

events {
}

http {
    include mime.types;
    server {
        listen 80;
        listen 443 ssl;
        server_name lava-land.ru www.lava-land.ru; 

        if ($scheme = 'http') {
            return 301 https://$host$request_uri;
        }

        ssl_certificate /etc/nginx/ssl/certificate.crt;
        ssl_certificate_key /etc/nginx/ssl/private.key;
        root /sites/lavaland;
        client_max_body_size 10000M;
      =
        location / {
            proxy_cache my_zone;
            proxy_cache_key "$host$request_uri$http_authorization";
            proxy_cache_valid 404 302 1m;
            proxy_cache_valid 200 1d;
            add_header X-Cache-Status $upstream_cache_status;

            proxy_pass 'http://localhost:5000/';
        }
        location /cloud/ {
            proxy_pass 'http://localhost:5000/cloud/';
        }
        location /messenger/ {
            proxy_pass 'http://localhost:5000/messenger/';
        }
        location /account/ {
            proxy_pass 'http://localhost:5000/account/';
        }
    }
}

